乱数を得る
==========

はじめに
--------

プログラミングにおける乱数は大きく、つぎのふたつにわけられます。

* 擬似乱数
* 暗号論的擬似乱数

それぞれのプログラムの持つ目的によって、きちんと使いわける必要があります。

擬似乱数
--------

### 特徴、用途

生成される乱数列を十分に長く観察することで、
続く値を予測することが可能である場合があります。
ゲーム、シミュレーション、乱択アルゴリズムなどに使われます。

### random

#### 特徴

Haskell 98標準に準拠したライブラリ。
つぎのような特徴があります。

* 周期が短い
* 生成が遅い

このような問題があるため、Haskell 2010では、標準としては含まれていません。
パッケージrandomとして使うことができます。

#### 使用法

##### 乱数の種を取得する

乱数の種を取得するには、整数を変換して種をつくる方法と、
システムが生成した種を取り出すという方法とがあります。

###### 整数値から乱数の種をつくる

Int型の整数から乱数の種をつくるには関数mkStdGenを使います。

```haskell
-- random
> :module System.Random
> mkStdGen 8
9 1
> mkStdGen 123
124 1
```

関数mkStdGenの型は、つぎのようになります。

```haskell
mkStdGen :: Int -> StdGen
```

乱数の種を特定の整数からつくることで、
つねにおなじ並びとなる乱数列を取得することができます。

###### 起動のたびに異なる乱数の種を取得する

起動のたびに異なる乱数の種を取得するにはIO値getStdGenを使います。

```haskell
-- random
> :module System.Random
> getStdGen
852161251 1
```

システムによって、起動のたびに異なるように初期化されたランダムの種が
取得できます。

getStdGenはIO値です。
対話環境では入力された値が、通常の値であれば、評価してその値を表示します。
IO値であれば、それが表すアクションを実行して、結果として得られる値を表示します。

IO値getStdGenの型は、つぎのようになります。

```haskell
getStdGen :: IO StdGen
```

##### 種から乱数を得る

乱数の種から乱数を得るには関数randomを使います。

```haskell
-- random
> :module System.Random
> g = mkStdGen 8
> random g
(-398575370259562870,1380072070 2103410263)
```

関数randomは乱数値と新しい種をかえします。
乱数値は、デフォルトではInteger型の値となります。
型を指定することもできます。

```haskell
> random g :: (Double, StdGen)
(0.7492446889336446,1380072070 2103410263)
> random g :: (Bool, StdGen)
(True,360126 40692)
> random g :: (Char, StdGen)
('\319433',360126 40692)
```

新しい種から、つぎの乱数値を作ることができます。

```haskell
> random g :: (Char, StdGen)
('\319433',360126 40692)
> random $ snd it :: (Char, StdGen)
('\282363',1525180386 1655838864)
```

このようにして、ひとつの種から、
つぎつぎに新しい乱数値を生成していくことができます。

##### 無限乱数列を取得する

乱数をひとつずつ作っていくかわりに、生成されるすべての乱数を含む、
無限数列を作ることができます。
このような無限リストを作るには関数randomsを使います。

```haskell
-- random
> :module System.Random
> g = mkStdGen 8
> take 100 $ randoms g
[-398575370259562870,-6370604356117182359,8399777519602674086,...
```

##### IO内で簡単に乱数を取得する

乱数の種を更新しながら、
乱数をひとつずつ取り出すには、つぎのように実行します。

```haskell
-- random
> :module System.Random
> getStdGen
551091070 1
> random it :: (Int, StdGen)
(7702268877985608548,1221636208 2103410263)
> setStdGen $ snd it
> getStdGen
1221636208 2103410263
> random it :: (Int, StdGen)
(6127740995264203513,8356773621 1780294415)
> setStdGen $ snd it
```

IO値getStdGenで現在、システムに保存されている乱数の種を取得し、
関数randomでランダムな値と、新しい乱数の種を計算します。
そして、関数setStdGenを使って、新しい乱数の種をシステムに保存します。

このような動きをまとめたのがIO値randomIOです。

```haskell
> randomIO :: IO Int
7202189668116739859
> randomIO :: IO Int
8741390758431768255
```

IO値randomIOは、手軽に乱数値を取得できる便利な値です。

##### 乱数の範囲を指定する

##### 乱数の種をふたつにわける

##### システムから新しい乱数の種を取り出す

### mwc-random

#### 特徴

MWC256というアルゴリズムを使ったライブラリ。
つぎのような特徴がある。

* 周期が長い
* 生成が速い

#### 使用法

暗号論的擬似乱数
----------------

### 特徴、用途

それまでに生成してきた乱数列から、つぎの値を予測することが困難である。
暗号技術において、実質的に予測不可能な値を生成するために使われる。

### cryptonite
